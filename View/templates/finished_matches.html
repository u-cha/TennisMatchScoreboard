<!DOCTYPE html>
<html>
    <head >
        <meta lang="en">
        <link rel="stylesheet" type="text/css" href="css/styles.css">
    </head>

    <body>
        <div class="logo">
            <p>
                <b>Finished Matches</b>
            </p>
        </div>



        <div class="container">
            <form action="/matches" method="get" id="pagination_form">
                    <label for="player_select">Filter by player</label>
                        <select name="filter_by_player_name" id="filter_by_player_name">
                            <option value = "all"> --ALL-- </option>
                                {% for player_name in player_names_list %}
                                <option value="{{player_name}}">{{player_name}}</option>
                                {% endfor %}
                        </select>

                    <label for="num_rows_select">Number of records per page</label>
                        <select name="num_rows" id="num_rows">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    <input type="submit" class="submit_button" value="Refresh">
            </form>
        </div>


        <div class="container">
            <button id="PrevButton" class="submit_button"> PREV </button>
            <button id="NextButton" class="submit_button"> NEXT </button>
        </div>

        <div>
            <a  href ="/">TO MAIN PAGE</a>
            <table class="finishedmatchestable">
                <tr class="match_row">
                    <td>#</td>
                    <td>Player1</td>
                    <td>Player2</td>
                    <td>Match Winner</td>
                    <td>Set 1</td>
                    <td>Set 2</td>
                    <td>Set 3</td>

                </tr>

                {% for match in output %}
                <tr>
                    <td></td>
                    <td>{{match["player1"]}}</td>
                    <td>{{match.player2}}</td>
                    <td>{{match.winner}}</td>
                    <td>{{match.set1_results}}</td>
                    <td>{{match.set2_results}}</td>
                    <td>{{match.set3_results}}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded",
                           function() {var qs_data = parseQueryString();
                                        presetSelects(qs_data);
                                        replaceQueryString(qs_data);}
                                    );

            function parseQueryString() {
              const urlParams = new URLSearchParams(window.location.search);
              var num_rows = urlParams.get('num_rows');
              var page = urlParams.get('page');
              var filter_by_player_name = urlParams.get('filter_by_player_name');
              if (!num_rows) {
                            num_rows = "10";
              };
              if (!page) {
                            page = "1";
              };
              if (!filter_by_player_name){
                            filter_by_player_name = "all";
              };
              return {
                num_rows: num_rows,
                page: page,
                filter_by_player_name: filter_by_player_name,
              };
            };

            function presetSelects(qs_data) {
                document.getElementById("num_rows").value = qs_data.num_rows;
                document.getElementById("filter_by_player_name").value = qs_data.filter_by_player_name;
            };

            function replaceQueryString(qs_data) {
                var url = new URL(window.location.href);
                url.searchParams.set("filter_by_player_name", qs_data.filter_by_player_name);
                url.searchParams.set("num_rows", qs_data.num_rows);
                url.searchParams.set("page", qs_data.page);

                window.history.replaceState({}, '', url);
            };

            function processNextButton() {
                var url = new URL(window.location.href);
                var currentPageNum = parseInt(url.searchParams.get("page"));
                var nextPageNum = currentPageNum + 1;
                url.searchParams.set("page", nextPageNum);
                window.location.href = url;
            };



            function processPrevButton() {
                var url = new URL(window.location.href);
                var currentPageNum = parseInt(url.searchParams.get("page"));
                if (currentPageNum > 1) {
                    var nextPageNum = currentPageNum - 1;}
                else {
                    var nextPageNum = currentPageNum;
                };
                    url.searchParams.set("page", nextPageNum);
                window.location.href = url;

            };


            NextButton.addEventListener("click", function() {processNextButton();});
            PrevButton.addEventListener("click", function() {processPrevButton();});
        </script>

    </body>

</html>